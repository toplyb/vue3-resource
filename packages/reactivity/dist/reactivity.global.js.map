{"version":3,"file":"reactivity.global.js","sources":["../src/effect.ts","../../shared/src/index.ts","../src/reactive.ts"],"sourcesContent":["const effectStack = []\nlet activeEffect\n// 需要让 effect 记录依赖了哪些属性，同时属性也记录依赖了哪些 effect\nclass ReactiveEffect {\n  // 记录是否是响应式的\n  active = true\n  // 记录依赖了哪些属性\n  deps = []\n\n  constructor(public fn) {\n\n  }\n\n  run() {\n    // 如果是非响应式的，则直接执行即可\n    if (!this.active) {\n      return this.fn()\n    }\n\n    // 如果 effect 已经存在，则不保存\n    if (!(effectStack.indexOf(this) === -1)) {\n      try {\n        activeEffect = this\n        effectStack.push(this)\n        return this.fn()\n      } finally {\n        effectStack.pop()\n        activeEffect = effectStack[effectStack.length - 1]\n      }\n    }\n  }\n}\n\nexport function effect(fn) {\n  const _effect = new ReactiveEffect(fn)\n\n  _effect.run()\n}\n\n// 依赖收集\nexport function track(target, key) {\n  console.log(target)\n  console.log(key)\n}\n","export function isObject(value: unknown): value is Record<any, any> {\n  return typeof value === 'object' && value !== null\n}\n","import { isObject } from '@vue/shared'\nimport { track } from './effect'\n\nconst enum ReactiveFlags {\n  IS_REACTIVE = '__v_isReactive'\n}\n\nconst mutableHandlers = {\n  get(target: Record<any, any>, key: string | symbol, receiver: any): any {\n    // 如果对象被代理过，则在刚进来的时候，就会取 __v_isReactive 属性，此时就可以直接返回 true\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true\n    }\n    // 依赖收集\n    track(target, key)\n    // 相当于 target[key]\n    const res = Reflect.get(target, key, receiver)\n    return res\n  },\n  set(target: Record<any, any>, key: string | symbol, value: any, receiver: any): boolean {\n    // 相当于 target[key] = value，但是 Reflect 会自动返回一个布尔值，表示是否设置成功\n    return Reflect.set(target, key, value, receiver)\n  }\n}\n\n// weakMap 是弱引用，key 必须是对象，如果 key 没有被引用，则会自动销毁\nconst reactiveMap = new WeakMap()\n\nfunction createReactiveObject(target: object) {\n\n  // 默认认为 target 是被代理过的\n  if ((target as any)[ReactiveFlags.IS_REACTIVE]) {\n    return target\n  }\n\n  if (!isObject(target)) {\n    return target\n  }\n\n  // 判断当前对象是否被代理过，如果被代理过，就直接返回代理后的对象\n  const existingProxy = reactiveMap.get(target)\n  if (existingProxy) {\n    return existingProxy\n  }\n\n  const proxy = new Proxy(target, mutableHandlers)\n  reactiveMap.set(target, proxy)\n  return proxy\n}\n\nexport function reactive(target: object) {\n  return createReactiveObject(target)\n}\n"],"names":[],"mappings":"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"}